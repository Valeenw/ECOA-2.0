<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E.C.O.A - Datos de Envío</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
<header>
    <h1>E.C.O.A</h1>
    <nav>
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="tiendas.html">Tienda</a></li> 
            </ul>
    </nav>
</header>

<main id="main-content">
    <section class="contenido">
        <h2>Datos de Envío y Pago</h2>
        
        <div class="resumen-compra">
            <h3>Resumen de la Orden</h3>
            <p>Productos: <span id="resumen-productos">Cargando...</span></p>
            <p>Total a Pagar: <span id="resumen-total">$0 MXN</span></p>
        </div>

        <form id="form-envio" onsubmit="enviarFormulario(event)">
            <h3>Información de Contacto y Envío</h3>

            <label for="nombre">Nombre Completo:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" name="email" required>
            
            <label for="direccion">Dirección de Envío:</label>
            <textarea id="direccion" name="direccion" required></textarea>

            <label for="cp">Código Postal:</label>
            <input type="text" id="cp" name="cp" required>

            <button type="submit" class="btn-finalizar">Confirmar y Pagar</button>
        </form>
    </section>
</main>

<footer>
    <p>2050 E.C.O.A - Especies de Conciencia Artificial</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const carritoData = localStorage.getItem('carritoECOA');
        const totalData = localStorage.getItem('totalECOA');
        
        const resumenProductos = document.getElementById('resumen-productos');
        const resumenTotal = document.getElementById('resumen-total');
        
        if (carritoData && totalData) {
            const carrito = JSON.parse(carritoData);
            const total = parseFloat(totalData);

            const nombres = carrito.map(item => item.nombre).join(', ');
            resumenProductos.textContent = nombres;
            
            resumenTotal.textContent = `$${total.toLocaleString('es-MX')} MXN`;

        } else {
            resumenProductos.textContent = "El carrito está vacío o la sesión expiró.";
            alert("No se encontraron productos en el carrito. Serás redirigido a la tienda.");
            window.location.href = 'tiendas.html';
        }
    });

    function enviarFormulario(event) {
        event.preventDefault(); 

        alert("Procesando tu orden...");
        
        localStorage.removeItem('carritoECOA');
        localStorage.removeItem('totalECOA');

        window.location.href = 'compra_finalizada.html';
    }
</script>
</body>
</html>